{
  "_args": [
    [
      {
        "raw": "s3-image-uploader",
        "scope": null,
        "escapedName": "s3-image-uploader",
        "name": "s3-image-uploader",
        "rawSpec": "",
        "spec": "latest",
        "type": "tag"
      },
      "/home/abhishek/WebstormProjects/Be Inspired"
    ]
  ],
  "_from": "s3-image-uploader@latest",
  "_id": "s3-image-uploader@1.0.7",
  "_inCache": true,
  "_location": "/s3-image-uploader",
  "_nodeVersion": "4.4.1",
  "_npmOperationalInternal": {
    "host": "packages-12-west.internal.npmjs.com",
    "tmp": "tmp/s3-image-uploader-1.0.7.tgz_1478629499016_0.28343123313970864"
  },
  "_npmUser": {
    "name": "adamhenson",
    "email": "adamhenson1979@gmail.com"
  },
  "_npmVersion": "3.5.1",
  "_phantomChildren": {},
  "_requested": {
    "raw": "s3-image-uploader",
    "scope": null,
    "escapedName": "s3-image-uploader",
    "name": "s3-image-uploader",
    "rawSpec": "",
    "spec": "latest",
    "type": "tag"
  },
  "_requiredBy": [
    "#USER",
    "/"
  ],
  "_resolved": "https://registry.npmjs.org/s3-image-uploader/-/s3-image-uploader-1.0.7.tgz",
  "_shasum": "770ea8e559f524d59ccb549da47baf10e1bc4bc0",
  "_shrinkwrap": null,
  "_spec": "s3-image-uploader",
  "_where": "/home/abhishek/WebstormProjects/Be Inspired",
  "author": {
    "name": "Adam Henson",
    "email": "adamhenson1979@gmail.com"
  },
  "bugs": {
    "url": "https://github.com/adamhenson/s3-image-uploader/issues"
  },
  "dependencies": {
    "extend": "^3.0.0",
    "gm": "~1.16.0",
    "s3": "~4.2.0",
    "ws": "~0.4.32"
  },
  "description": "A Node.js module for resizing, and uploading files to Amazon S3 with capability to track progress using websockets.",
  "devDependencies": {},
  "directories": {},
  "dist": {
    "shasum": "770ea8e559f524d59ccb549da47baf10e1bc4bc0",
    "tarball": "https://registry.npmjs.org/s3-image-uploader/-/s3-image-uploader-1.0.7.tgz"
  },
  "engines": {
    "node": ">= 0.10"
  },
  "gitHead": "9d01cd8ac0fbc312e446d14e9596f94673265127",
  "homepage": "https://github.com/adamhenson/s3-image-uploader/issues",
  "keywords": [
    "s3",
    "websockets",
    "image",
    "uploader",
    "aws",
    "resize"
  ],
  "license": "MIT",
  "main": "index.js",
  "maintainers": [
    {
      "name": "adamhenson",
      "email": "adamhenson1979@gmail.com"
    }
  ],
  "name": "s3-image-uploader",
  "optionalDependencies": {},
  "readme": "#s3-image-uploader\n\n[![npm](https://img.shields.io/npm/v/s3-image-uploader.svg)]()\n[![npm](https://img.shields.io/npm/dm/s3-image-uploader.svg)]()\n[![npm](https://img.shields.io/npm/dt/s3-image-uploader.svg)]()\n\n> A Node.js module for resizing, and uploading files to Amazon S3 with capability to track progress using websockets.\n>\n> This module was created to use with little setup and customization as it's simply a wrapper of [AWS SDK](http://aws.amazon.com/sdk-for-node-js/) and [gm](https://github.com/aheckmann/gm). This module also utilizes [Websockets](https://github.com/einaros/ws), which can be optionally enabled to allow the server to send the client messages such as file upload completion and upload progress.\n\n## Installation\n\nInstall package with NPM and add it to your dependencies.\n\n```\n$ npm install s3-image-uploader --save\n```\n\n## Dependencies\n\nWhen you npm install this module - the module dependencies are added ([s3](https://github.com/andrewrk/node-s3-client), [gm](https://github.com/aheckmann/gm), [ws](https://www.npmjs.org/package/ws)), however you'll need to make sure [GraphicsMagick](http://www.graphicsmagick.org/) is installed on your server. GraphicsMagick is the image manipulation library this module uses.\n\nAlso, you'll need to pay attention to how you're server handles timeouts.\n\nI used the following code in my Express application to make sure the post didn't timeout:\n\n```javascript\napp.post('/post-image', function(req, res, next){\n\n  res.connection.setTimeout(0); // this could take a while\n  // code to execute post here\n\n});\n```\n\n## Usage\n\nBelow is the basic configuration, but you can see [full example code here](https://github.com/adamhenson/example-s3-image-uploader)\n\n### Server Side (Node)\n\nInclude the module.\n\n```javascript\nvar Uploader = require('s3-image-uploader');\n```\n\n#### Instantiation\nInstantiate the uploader with options. Note that if we didn't want to use websockets functionality - we would add to our options ```websockets : false```.\n\nAlso, note that we're using properties of the user [environment](http://nodejs.org/api/process.html#process_process_env), but these could be variables or hard coded if preferred (not ideal for security).\n\n```javascript\nvar uploader = new Uploader({\n  aws : {\n    key : process.env.NODE_AWS_KEY,\n    secret : process.env.NODE_AWS_SECRET\n  },\n  websocketServer : server,\n  websocketServerPort : 3004,\n});\n```\n\n#### Resize\n\nWidth and height options denote the maximum size for the dimension (will be exact if the other dimension is set to 'auto'... but upsizing will not happen). If not defined or set to 'auto' - the dimension will be resized based on aspect ratio of the other. Aspect ratio is always maintained. If ```square : true``` is set and width/height are equal, the smaller dimension will be sized down and the larger will be trimmed off outside of the center.\n\n```fileId``` is important for the websockets functionality. It's referenced in messages sent to the client about the status. Therefore you may want to use this same identifier as a DOM selector in your client side code (maybe a data attribute) to target visual representations of the messages.\n\n```javascript\nuploader.resize({\n  fileId : 'someUniqueIdentifier',\n  width : 600,\n  height : 'auto',\n  source : './public/tmp/myoldimage.jpg',\n  destination : './public/uploads/mynewimage.jpg'\n}, function(destination){\n  console.error('resize success - new image here: ', destination);\n  // execute success code\n}, function(errMsg){\n  console.error('unable to resize: ', errMsg);\n  // execute error code\n});\n```\n\n#### Validate File Type\n\nThis validates the content type referenced in the header of the file.\n\n```fileId``` is again referenced in messages sent to the client about the status.\n\n```javascript\nif(uploader.validateType(file, fileId, ['image/jpeg', 'image/gif', 'image/png'])) {\n  console.log('validation passed!');\n  // execute success code\n}\n```\n\n#### Get Exif Data\n\nGet the exif data object.\n\n```javascript\nuploader.getExifData(filePath, function(data){\n\n  // normally I'd do something with this... like store it in a database\n  console.log('exif data', data);\n\n});\n```\n\n#### Get Image Size\n\nGet dimension object from image.\nThe below code will log something like this: `{ width: 1200, height: 900 }`\nThis method uses the GraphicsMagick `size` method. Find [more documentation here](http://aheckmann.github.io/gm/docs.html).\n\n```javascript\nuploader.getSize(filePath, function(data){\n\n  console.log('image size data', data);\n\n});\n```\n\n#### Upload\n\nUpload the file to s3.\n\n```fileId``` is again referenced in messages sent to the client about the status.\n\n```javascript\nuploader.upload({\n  fileId : 'someUniqueIdentifier',\n  bucket : 'somebucket',\n  source : './public/tmp/myoldimage.jpg',\n  name : 'mynewimage.jpg'\n},\nfunction(data){ // success\n  console.log('upload success:', data);\n  // execute success code\n},\nfunction(errMsg, errObject){ //error\n  console.error('unable to upload: ' + errMsg + ':', errObject);\n  // execute error code\n});\n```\n\n#### Delete\n\nDelete an array of files from AWS (array can include only one file if desired).\n\n```javascript\nuploader.delete('somebucket', ['cat.jpg', 'dog.png', 'turtle.gif'], function(data){\n  console.log('yay!', data);\n}, function(err){\n  console.log('fail!', err);\n});\n```\n\n## Options\n\n### new Uploader\n* @param {object} options - Configuration object. Required.\n  * {object} options.aws - aws object. Required.\n  * {string} options.aws.key - aws key string. Required.\n  * {string} options.aws.secret - aws secret string. Required.\n  * {object} options.websocketServer - WebSocket server object. Optional.\n  * {number} options.websocketServerPort - WebSocket server port. Optional.\n  * {object} options.s3Params - object that can extend the S3 parameters listed here http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html. Optional. Example: `s3Params : { 'CacheControl' : 'max-age=3600'}`\n\n### resize\n* @param {object} options - Configuration object. Required.\n  * {string} options.fileId - Used to uniquely identify file. Required.\n  * {number || 'auto'} options.width - Maximum width allowed for resized image. Otherwise if not defined or set to 'auto' - width will be resized based on aspect ratio of height. Optional. Default is 'auto'.\n  * {number || 'auto'} options.height - Maximum height allowed for resized image. Otherwise if not defined or set to 'auto' - height will be resized based on aspect ratio of width. Optional. Default is 'auto'.\n  * {string} options.source - Path to the image to be resized. Required.\n  * {string} options.destination - Path to new image after resize. Required.\n  * {number} options.quality - Quality for resized image (1-100... 100 is best). Optional. Default is 100.\n  * {boolean} options.square - boolean flag set to true if the image needs to be square. Optional. Default is false.\n  * {boolean} options.noProfile - boolean flag set to true if exif data should be removed (minimizing file size). Optional. Default is true.\n  * {number || boolean} options.maxFileSize - can be a number or boolean false. The number represents file size in MegaBytes. Optional. Default is false.\n* @param {function} successCallback - Callback function. Receives one argument - {string} path to resized file. Required.\n* @param {function} errorCallback - Callback function. Receives one argument - {string} error message. Required.\n\n### validateType\n* @param {object} file - Post object. Required.\n* @param {string} id - Used to uniquely identify file. Required.\n* @param {array} types - Array of string file content types (example: ['image/jpeg', 'image/gif', 'image/png']). Required.\n\n### getExifData\n* @param {string} source - Path of image. Required.\n* @param {function} callback - Callback that receives argument of false or data object. Required.\n\n### getSize\n* @param {string} source - Path of image. Required.\n* @param {function} callback - Callback that receives argument of false or data object. Required. The received data object will be in a format similar to this: `{ width: 1200, height: 900 }`\n\n### upload\n* @param {object} options - Configuration object. Required.\n  * {string} options.fileId - Used to uniquely identify file. Required.\n  * {string} options.bucket - S3 bucket. Required.\n  * {string} options.source - Path to the image to be uploaded. Required.\n  * {string} options.name - Name to be used for new file uploaded to S3. Required.\n  * {number || boolean} options.maxFileSize - can be a number or boolean false. The number represents file size in MegaBytes. Optional. Default is false.\n* @param {function} successCallback - Callback function. Receives one argument - {object} status object. Required.\n* @param {function} errorCallback - Callback function. Receives two arguments - {string} error message. {object} error stack trace. Required.\n\n### delete\n* @param {string} bucket - AWS bucket name. Required.\n* @param {array} fileNames - Array of string filenames (example: ['cat.jpg', 'dog.png', 'turtle.gif']). Required.\n* @param {function} successCallback - Callback that receives data object. Required.\n* @param {function} errorCallback - Callback that receives error object. Optional.\n\n## On the Client Side\n\nPlease see a [full example here](https://github.com/adamhenson/example-s3-image-uploader/blob/master/public/js/uploader.js).\n\nThe most important thing to consider here is that we're receiving ```fileId``` from the server as ```id``` to uniquely identify the upload. We receive message objects via websockets. Below are examples of different messages we might receive on the client.\n\n> Error message\n\n```javascript\n{\n  type : 'error',\n  id : 'someUniqueIdentifier',\n  message : 'There was a problem uploading this file.'\n}\n```\n\n> Upload progress message\n\n```javascript\n{\n  type : 'progress',\n  id : 'someUniqueIdentifier',\n  progressAmount : 5276653, // represents bytes\n  progressTotal : 6276653 // represents bytes\n}\n```\n\n> Upload success message\n\n```javascript\n{\n  type : 'result',\n  id : 'someUniqueIdentifier',\n  path : '/mybucket/myimage.jpg'\n}\n```\n\n> Resize success message\n\n```javascript\n{\n  type : 'resize',\n  id : 'someUniqueIdentifier',\n  size : '100x100'\n}\n```\n\nSo, a simple implementation of this might look something like this.\n\nMake the websocket connection.\n\n```javascript\nvar host = window.document.location.host.replace(/:.*/, '');\nvar ws = new WebSocket('ws://' + host + ':8080');\n```\n\nHandle messages from the server about the progress of our upload/s and resizing.\n\n```javascript\nws.onmessage = function(event){\n  var message = JSON.parse(event.data);\n  if(typeof message.type !== 'undefined') {\n    if(message.type === 'progress') // execute code for progress\n    else if(message.type === 'result') // execute code for result\n    else if(message.type === 'resize') // execute code for resize status\n    else if(message.type === 'error') // execute code for error messages\n  }\n};\n```",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git+https://github.com/adamhenson/s3-image-uploader.git"
  },
  "scripts": {},
  "version": "1.0.7"
}
